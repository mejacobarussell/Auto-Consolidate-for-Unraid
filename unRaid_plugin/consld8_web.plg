<?xml version="1.0" encoding="utf-8"?>

<plugin>
<!-- CHANGED ID to ConsolidatorTool to isolate from any cache issues -->
<id>ConsolidatorTool</id>
<name>Disk Consolidator (consld8)</name>
<version>1.0.7</version>
<category>Tools</category>
<description>Consolidates fragmented user share folders onto a single disk using rsync, based on the consld8 script.</description>
<author>Jacob Russell</author>
<website>https://www.google.com/search?q=https://yourwebsite.com</website>
<minSystem>6.0.0</minSystem>
<!-- Added maxSystem tag for completeness -->
<maxSystem>7.0.0</maxSystem>

<!-- Icon path matches the new ID folder: /usr/local/emhttp/plugins/ConsolidatorTool/ -->

<icon>/plugins/ConsolidatorTool/icon.png</icon>

<plugin_dialog title="Disk Consolidator Installation" yes="Done" no="No" window_content='The Disk Consolidator has been successfully installed. You can find it under the Plugins menu.'>
</plugin_dialog>

<copy>
<!-- All file destinations updated to the new plugin folder. Permissions set to standard 0755 for executables. -->
<file src="consld8_web.sh" dest="/usr/local/emhttp/plugins/ConsolidatorTool/consld8_web.sh" mode="0755"/>
<file src="consld8-1.0.3.sh" dest="/usr/local/emhttp/plugins/ConsolidatorTool/consld8-1.0.3.sh" mode="0755"/>
<file src="Consld8.png" dest="/usr/local/emhttp/plugins/ConsolidatorTool/icon.png" mode="0644"/> <!-- Icon is a file, requires 0644 -->
</copy>

<page>
<id>consolidationtoolsettings</id>
<label>Disk Consolidator</label>
<!-- WebUI URL updated to match the new plugin folder -->
<url>/plugins/ConsolidatorTool/consld8_web.sh</url>
</page>

<remove>
<!-- Updated removal path -->
<file dest="/usr/local/emhttp/plugins/ConsolidatorTool"/>
</remove>

<!-- DEFINITIVE FIX: Using CDATA to guarantee the literal '&' is passed without breaking XML structure. -->

<hook event="post_install">
<if_true>
<shell_cmd><![CDATA[(sleep 5; /usr/local/sbin/emhttpd restart)&]]></shell_cmd>
</if_true>
</hook>

</plugin>
